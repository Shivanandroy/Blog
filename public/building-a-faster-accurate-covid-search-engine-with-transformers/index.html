<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗 - Shivanand Roy | Deep Learning</title><meta name="Description" content=""><meta property="og:title" content="Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗" />
<meta property="og:description" content="AbstractThis article will let you build a faster and accurate COVID Search Engine using Transformers🤗   Introduction In this article, we will build a search engine, which will not only retrieve and rank the articles based on the query but also give us the response, along with a 1000 words context around the response.
To achieve this, we will need:
 a structured dataset with reserach papers and its full text." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" />
<meta property="og:image" content="http://shivanandroy.com/images/covid-19.png" />
<meta property="article:published_time" content="2020-09-06T00:42:27+05:30" />
<meta property="article:modified_time" content="2020-09-06T00:42:27+05:30" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://shivanandroy.com/images/covid-19.png"/>

<meta name="twitter:title" content="Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗"/>
<meta name="twitter:description" content="AbstractThis article will let you build a faster and accurate COVID Search Engine using Transformers🤗   Introduction In this article, we will build a search engine, which will not only retrieve and rank the articles based on the query but also give us the response, along with a 1000 words context around the response.
To achieve this, we will need:
 a structured dataset with reserach papers and its full text."/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" /><link rel="prev" href="http://shivanandroy.com/transformers-generating-arxiv-papers-title-from-abstracts/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Building A Faster \u0026 Accurate COVID Search Engine with Transformers🤗",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/shivanandroy.com\/building-a-faster-accurate-covid-search-engine-with-transformers\/"
        },"genre": "posts","keywords": "Deep Learning, Transformers, Search Engine","wordcount":  2941 ,
        "url": "http:\/\/shivanandroy.com\/building-a-faster-accurate-covid-search-engine-with-transformers\/","datePublished": "2020-09-06T00:42:27+05:30","dateModified": "2020-09-06T00:42:27+05:30","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Shivanand Roy"
            },"description": ""
    }
    </script>
		<script data-ad-client="ca-pub-1337012385171026" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    </head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Shivanand Roy | Deep Learning">Shivanand Roy</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Shivanand Roy | Deep Learning">Shivanand Roy</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Shivanand Roy</a></span>&nbsp;<span class="post-category">included in <a href="/categories/search-engine/"><i class="far fa-folder fa-fw"></i>Search Engine</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="06/09/2020">06/09/2020</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2941 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;14 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#data">Data</a></li>
        <li><a href="#code">Code</a></li>
        <li><a href="#haystack">Haystack</a></li>
        <li><a href="#-voila-were-done">🥳 Voila! We&rsquo;re Done.</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><div class="details admonition abstract open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ul fa-fw"></i>Abstract<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">This article will let you build a faster and accurate COVID Search Engine using <code>Transformers🤗</code></div>
        </div>
    </div>
<figure>
    <img src="/images/covid-19.png"/> 
</figure>

<h3 id="introduction">Introduction</h3>
<p>In this article, we will build a search engine, which will not only <strong>retrieve</strong> and <strong>rank</strong> the articles based on the query but also give us the <strong>response</strong>, along with a 1000 words <strong>context</strong> around the response.</p>
<p>To achieve this, we will need:</p>
<ul>
<li>a structured dataset with reserach papers and its full text.</li>
<li><code>Transformers</code> library to build QA model</li>
<li>and Finally, <code>Haystack</code> library to scale QA model to thousands of documents and build a search engine.</li>
</ul>
<h3 id="data">Data</h3>
<p>For this tutorial, we will use <a href="https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge" target="_blank" rel="noopener noreffer">COVID-19 Open Research Dataset Challenge (CORD-19)</a>.</p>
<blockquote>
<p>CORD-19 is a resource of over 200,000 scholarly articles, including over 100,000 with full text, about COVID-19, SARS-CoV-2, and related coronaviruses. This freely available dataset is provided to the global research community to apply recent advances in natural language processing and other AI techniques to generate new insights in support of the ongoing fight against this infectious disease.</p>
</blockquote>
<p>This dataset is ideal for building document retrieval system as it has full research paper content in text format. Columns like</p>
<ul>
<li><code>paper_id</code>: Unique identifier of research paper</li>
<li><code>title</code>: title of research paper</li>
<li><code>abstract</code>: Bried summary of the research paper</li>
<li><code>full_text</code>: Full text/content of the research paper</li>
</ul>
<p>are of our interest.</p>
<p>In <strong>Kaggle Folder Structure</strong> - There are 2 directories - <code>pmc_json</code> and <code>pdf_json</code> - which contains the data in the <code>json</code> format.
We will take 25,000 articles from <code>pmc_json</code> directory and 25000 articles from <code>pdf_json</code> - So, a total of 50,000 research articles to build our search engine.</p>
<p>We will extract <code>paper_id</code>, <code>title</code>, <code>abstract</code>, <code>full_text</code> and put it in an easy to use <code>pandas.DataFrame</code>.</p>
<h3 id="code">Code</h3>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>Note<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">We will use Kaggle notebook to write our code to leverage GPU.</div>
        </div>
    </div>
<p><strong>Load the data</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>


<span class="n">dirs</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;pmc_json&#34;</span><span class="p">,</span><span class="s2">&#34;pdf_json&#34;</span><span class="p">]</span>
<span class="n">docs</span><span class="o">=</span><span class="p">[]</span>
<span class="n">counts</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;../input/CORD-19-research-challenge/document_parses/{d}&#34;</span><span class="p">)):</span><span class="c1">#What is an f string?</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&#34;../input/CORD-19-research-challenge/document_parses/{d}/{file}&#34;</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">&#34;rb&#34;</span><span class="p">))</span>
        <span class="c1">#Taking last 7 characters. it removes the &#39;PMC&#39; appended to the beginning</span>
        <span class="c1">#also paperid in pdf_json are guids and hard to plot in the graphs hence the substring</span>
        <span class="n">paper_id</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;paper_id&#39;</span><span class="p">]</span>
        <span class="n">paper_id</span> <span class="o">=</span> <span class="n">paper_id</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span><span class="c1">#sometimes there are no abstracts</span>
            <span class="n">abstract</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">abstract</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
            
        <span class="n">full_text</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
        <span class="n">bib_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;body_text&#39;</span><span class="p">]:</span>
            <span class="n">full_text</span> <span class="o">+=</span> <span class="n">text</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
                
        <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">paper_id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="n">full_text</span><span class="p">])</span>
        <span class="c1">#comment this below block if you want to consider all files</span>
        <span class="c1">#comment block start</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span><span class="p">(</span><span class="n">counts</span> <span class="o">&gt;=</span> <span class="mi">25000</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="c1">#comment block end    </span>
<span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;paper_id&#39;</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span><span class="s1">&#39;full_text&#39;</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<p><code>pmc_json</code>
<code>34%|███▎      | 24999/74137 [01:29&lt;02:56, 278.06it/s]</code></p>
<p><code>pdf_json</code>
<code>25%|██▍       | 24999/100423 [01:24&lt;04:15, 295.09it/s]</code></p>
<hr>
<p><code>(50000, 4)</code></p>
<figure>
    <img src="/images/covid-search-engine-data.png"/> 
</figure>

<hr>
<p>We have 50,000 articles and columns like <code>paper_id</code>, <code>title</code>, <code>abstract</code> and <code>full_text</code></p>
<p>We will be interested in <code>title</code> and <code>full_text</code> columns as these columns will be used to build the engine. Let&rsquo;s setup a Search Engine on top <code>full_text</code> - which contains the full content of the research papers.</p>
<h3 id="haystack">Haystack</h3>
<p>Now, Welcome <code>Haystack</code>! The secret sauce behind setting up a search engine and ability to scale any QA model to thousands of documents.
<figure>
    <img src="/images/haystack1.png"/> 
</figure>
</p>
<p><code>Haystack</code> helps you scale QA models to large collections of documents! You can read more about this amazing library here <a href="https://github.com/deepset-ai/haystack">https://github.com/deepset-ai/haystack</a></p>
<p>For installation: <code>! pip install git+https://github.com/deepset-ai/haystack.git</code></p>
<p>But just to give a background, there are 3 major components to Haystack.</p>
<ul>
<li><strong>Document Store</strong>: Database storing the documents for our search. We recommend Elasticsearch, but have also more light-weight options for fast prototyping (SQL or In-Memory).</li>
<li><strong>Retriever</strong>: Fast, simple algorithm that identifies candidate passages from a large collection of documents. Algorithms include TF-IDF or BM25, custom Elasticsearch queries, and embedding-based approaches. The Retriever helps to narrow down the scope for Reader to smaller units of text where a given question could be answered.</li>
<li><strong>Reader</strong>: Powerful neural model that reads through texts in detail to find an answer. Use diverse models like BERT, RoBERTa or XLNet trained via FARM or Transformers on SQuAD like tasks. The Reader takes multiple passages of text as input and returns top-n answers with corresponding confidence scores. You can just load a pretrained model from Hugging Face&rsquo;s model hub or fine-tune it to your own domain data.</li>
</ul>
<p>And then there is <strong>Finder</strong> which glues together a <strong>Reader</strong> and a <strong>Retriever</strong> as a pipeline to provide an easy-to-use question answering interface.</p>
<p>Now, we can setup <code>Haystack</code> in 3 steps:</p>
<ol>
<li>Install <code>haystack</code> and import its required modules</li>
<li>Setup <code>DocumentStore</code></li>
<li>Setup <code>Retriever</code>, <code>Reader</code> and <code>Finder</code></li>
</ol>
<p><strong>1. Install <code>haystack</code></strong></p>
<p>Let&rsquo;s install <code>haystack</code> and import all the required modules</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># installing haystack</span>
<span class="err">!</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">deepset</span><span class="o">-</span><span class="n">ai</span><span class="o">/</span><span class="n">haystack</span><span class="o">.</span><span class="n">git</span>

<span class="c1"># importing necessary dependencies</span>
<span class="kn">from</span> <span class="nn">haystack</span> <span class="kn">import</span> <span class="n">Finder</span>
<span class="kn">from</span> <span class="nn">haystack.indexing.cleaning</span> <span class="kn">import</span> <span class="n">clean_wiki_text</span>
<span class="kn">from</span> <span class="nn">haystack.indexing.utils</span> <span class="kn">import</span> <span class="n">convert_files_to_dicts</span><span class="p">,</span> <span class="n">fetch_archive_from_http</span>
<span class="kn">from</span> <span class="nn">haystack.reader.farm</span> <span class="kn">import</span> <span class="n">FARMReader</span>
<span class="kn">from</span> <span class="nn">haystack.reader.transformers</span> <span class="kn">import</span> <span class="n">TransformersReader</span>
<span class="kn">from</span> <span class="nn">haystack.utils</span> <span class="kn">import</span> <span class="n">print_answers</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>2. Setting up <code>DocumentStore</code></strong></p>
<p>Haystack finds answers to queries within the documents stored in a <code>DocumentStore</code>. The current implementations of <code>DocumentStore</code> include <code>ElasticsearchDocumentStore</code>, <code>SQLDocumentStore</code>, and <code>InMemoryDocumentStore</code>.</p>
<p>But they recommend <code>ElasticsearchDocumentStore</code> because as it comes preloaded with features like full-text queries, BM25 retrieval, and vector storage for text embeddings.</p>
<p>So - Let&rsquo;s set up a <code>ElasticsearchDocumentStore</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="err">!</span> <span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">artifacts</span><span class="o">.</span><span class="n">elastic</span><span class="o">.</span><span class="n">co</span><span class="o">/</span><span class="n">downloads</span><span class="o">/</span><span class="n">elasticsearch</span><span class="o">/</span><span class="n">elasticsearch</span><span class="o">-</span><span class="mf">7.6</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="o">-</span><span class="n">q</span>
<span class="err">!</span> <span class="n">tar</span> <span class="o">-</span><span class="n">xzf</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="mf">7.6</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="err">!</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">daemon</span><span class="p">:</span><span class="n">daemon</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="mf">7.6</span><span class="o">.</span><span class="mi">2</span>
 
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">STDOUT</span>
<span class="n">es_server</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;elasticsearch-7.6.2/bin/elasticsearch&#39;</span><span class="p">],</span>
                   <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">STDOUT</span><span class="p">,</span>
                   <span class="n">preexec_fn</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">setuid</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># as daemon</span>
                  <span class="p">)</span>
<span class="c1"># wait until ES has started</span>
<span class="err">!</span> <span class="n">sleep</span> <span class="mi">30</span>

<span class="c1"># initiating ElasticSearch</span>
<span class="kn">from</span> <span class="nn">haystack.database.elasticsearch</span> <span class="kn">import</span> <span class="n">ElasticsearchDocumentStore</span>
<span class="n">document_store</span> <span class="o">=</span> <span class="n">ElasticsearchDocumentStore</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;localhost&#34;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&#34;document&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Once <code>ElasticsearchDocumentStore</code> is setup, we will write our documents/texts to the <code>DocumentStore</code>.</p>
<ul>
<li>Writing documents to <code>ElasticsearchDocumentStore</code> requires a format - List of dictionaries as shown below:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[
    {&#34;name&#34;: &#34;&lt;some-document-name&gt;, &#34;text&#34;: &#34;&lt;the-actual-text&gt;&#34;},
    {&#34;name&#34;: &#34;&lt;some-document-name&gt;, &#34;text&#34;: &#34;&lt;the-actual-text&gt;&#34;}
    {&#34;name&#34;: &#34;&lt;some-document-name&gt;, &#34;text&#34;: &#34;&lt;the-actual-text&gt;&#34;}
]
</code></pre></td></tr></table>
</div>
</div><p>(Optionally: you can also add more key-value-pairs here, that will be indexed as fields in Elasticsearch and can be accessed later for filtering or shown in the responses of the Finder)</p>
<ul>
<li>We will use <code>title</code> column to pass as <code>name</code> and <code>full_text</code> column to pass as the <code>text</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Now, let&#39;s write the dicts containing documents to our DB.</span>
<span class="n">document_store</span><span class="o">.</span><span class="n">write_documents</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;abstract&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;full_text&#39;</span><span class="p">:</span><span class="s1">&#39;text&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>3. Setup <code>Retriever</code>, <code>Reader</code> and <code>Finder</code></strong></p>
<p>Retrievers help narrowing down the scope for the Reader to smaller units of text where a given question could be answered. They use some simple but fast algorithm.</p>
<p>Here: We use Elasticsearch&rsquo;s default BM25 algorithm</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">haystack.retriever.sparse</span> <span class="kn">import</span> <span class="n">ElasticsearchRetriever</span>
<span class="n">retriever</span> <span class="o">=</span> <span class="n">ElasticsearchRetriever</span><span class="p">(</span><span class="n">document_store</span><span class="o">=</span><span class="n">document_store</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>A Reader scans the texts returned by retrievers in detail and extracts the k best answers. They are based on powerful, but slower deep learning models.</p>
<p>Haystack currently supports Readers based on the frameworks <code>FARM</code> and <code>Transformers</code>. With both you can either load a local model or one from <code>Hugging Face's</code> model hub (<a href="https://huggingface.co/models)">https://huggingface.co/models)</a>.</p>
<p>Here: a medium sized RoBERTa QA model using a Reader based on FARM (<a href="https://huggingface.co/deepset/roberta-base-squad2">https://huggingface.co/deepset/roberta-base-squad2</a>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">reader</span> <span class="o">=</span> <span class="n">FARMReader</span><span class="p">(</span><span class="n">model_name_or_path</span><span class="o">=</span><span class="s2">&#34;deepset/roberta-base-squad2&#34;</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">context_window_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Downloading: 100%</code>
<code>1.26k/1.26k [00:33&lt;00:00, 37.9B/s]</code></p>
<p><code>Downloading: 100%</code>
<code>499M/499M [00:22&lt;00:00, 21.8MB/s]</code></p>
<p><code>Downloading: 100%</code>
<code>899k/899k [00:03&lt;00:00, 272kB/s]</code></p>
<p><code>Downloading: 100%</code>
<code>456k/456k [00:01&lt;00:00, 252kB/s]</code></p>
<p><code>Downloading: 100%</code>
<code>150/150 [00:01&lt;00:00, 97.1B/s]</code></p>
<p><code>Downloading: 100%</code>
<code>190/190 [00:00&lt;00:00, 342B/s]</code></p>
<p>And finally: The Finder sticks together reader and retriever in a pipeline to fetch answers based on our query.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">finder</span> <span class="o">=</span> <span class="n">Finder</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">retriever</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="-voila-were-done">🥳 Voila! We&rsquo;re Done.</h3>
<p>Let&rsquo;s see, how well our search engine works! - For simplicity, we will keep the number of documents to be retrieved to 2 using <code>top_k_reader</code> parameter. But we can extend to any number in production.</p>
<p>Now, whenever we search or query our <code>DocumentStore</code>, we get 3 responses-</p>
<ul>
<li>we get the <strong>answer</strong></li>
<li>a 1000 words <strong>context</strong> around the answer</li>
<li>and the <strong>name/title</strong> of the research paper</li>
</ul>
<hr>
<p><strong>Example 1: What is the impact of coronavirus on babies?</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;What is the impact of coronavirus on babies?&#34;</span>
<span class="n">number_of_answers_to_fetch</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">get_answers</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span> <span class="n">top_k_retriever</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">top_k_reader</span><span class="o">=</span><span class="n">number_of_answers_to_fetch</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Question: {prediction[&#39;question&#39;]}&#34;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_answers_to_fetch</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;#{i+1}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Answer: {prediction[&#39;answers&#39;][i][&#39;answer&#39;]}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Research Paper: {prediction[&#39;answers&#39;][i][&#39;meta&#39;][&#39;name&#39;]}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Context: {prediction[&#39;answers&#39;][i][&#39;context&#39;]}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.17 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.83 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.71 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.75 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.78 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.83 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:01&lt;00:00,  1.08s/ Batches]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:01&lt;00:00,  1.09s/ Batches]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.83 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.57 Batches/s]</code></p>
<hr>
<p><code>Question: What is the impact of coronavirus on babies?</code></p>
<p><code>#1</code></p>
<p><code>Answer:  While babies have been infected, the naivete of the neonatal immune system in relation to the inflammatory response would appear to be protective, with further inflammatory responses achieved with the consumption of human milk.</code></p>
<p><code>Research Paper: COVID 19 in babies: Knowledge for neonatal care</code></p>
<p><code>Context: ance to minimize the health systems impact of this pandemic across the lifespan.The Covid-19 pandemic has presented neonatal nurses and midwives with challenges when caring for mother and babies. This review has presented what is currently known aboutCovid-19 and neonatal health, and information and research as they are generated will add to a complete picture of the health outcomes. While babies have been infected, the naivete of the neonatal immune system in relation to the inflammatory response would appear to be protective, with further inflammatory responses achieved with the consumption of human milk. The WHO has made clear recommendations about the benefits of breastfeeding, even if the mother and baby dyad is Covid-19 positive, if they remain well. The mother and baby should not be separated, and the mother needs to be able to participate in her baby's care and develop her mothering role. The complexities of not being able to access her usual support people mean that the mother</code></p>
<hr>
<hr>
<p><code>#2</code>
<code>Answer:  neonate are mild, with low-grade fever and gastrointestinal signs such as poor feeding and vomiting. The respiratory symptoms are also limited to mild tachypnoea and/or tachycardia.</code></p>
<p><code>Research Paper: COVID 19 in babies: Knowledge for neonatal care</code></p>
<p><code>Context: Likewise, if the mother and baby are well, skin-to-skin and breast feeding should be encouraged, as the benefits outweigh any potential harms. If a neonate becomes unwell and requires intensive care, they should be nursed with droplet precautions in a closed incubator in a negative pressure room. The management is dictated by the presenting signs and symptoms. It would appear the presenting symptoms in the neonate are mild, with low-grade fever and gastrointestinal signs such as poor feeding and vomiting. The respiratory symptoms are also limited to mild tachypnoea and/or tachycardia. However, as there has been a presentation of seizure activity with fever a neurological examination should be part of the investigations.As of writing this paper, there has been a preliminary study published in the general media The WHO has also welcomed these preliminary results and state it is &quot;looking forward to a full data analysis&quot; (https://www.who.int/news-room/detail/16-06-2020-who-welcomesprelimin</code></p>
<hr>
<p><strong>Example 2: What is the impact of coronavirus on pregnant women?</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;What is the impact of coronavirus on pregnant women?&#34;</span>
<span class="n">number_of_answers_to_fetch</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">get_answers</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span> <span class="n">top_k_retriever</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">top_k_reader</span><span class="o">=</span><span class="n">number_of_answers_to_fetch</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Question: {prediction[&#39;question&#39;]}&#34;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_answers_to_fetch</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;#{i+1}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Answer: {prediction[&#39;answers&#39;][i][&#39;answer&#39;]}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Research Paper: {prediction[&#39;answers&#39;][i][&#39;meta&#39;][&#39;name&#39;]}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Context: {prediction[&#39;answers&#39;][i][&#39;context&#39;]}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.17 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.83 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.71 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.75 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.78 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.83 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:01&lt;00:00,  1.08s/ Batches]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:01&lt;00:00,  1.09s/ Batches]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.83 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.57 Batches/s]</code></p>
<hr>
<p><code>Question: What is the impact of coronavirus on pregnant women?</code></p>
<p><code>#1</code>
<code>Answer:  pregnant woman may be more vulnerable to severe infection (Favre et al. 2020 ) and evidence from previous viral outbreaks suggests a higher risk of unfavourable maternal and neonatal outcomes in this population</code></p>
<p><code>Research Paper: COVID 19 in babies: Knowledge for neonatal care</code></p>
<p><code>Context: na. The disease manifests with a spectrum of symptoms ranging from mild upper respiratory tract infection to severe pneumonitis, acute respiratory distress syndrome (ARDS) and death.Relatively few cases have occurred in children and neonates who seem to have a more favourable clinical course than other age groups (De Rose et al. 2020) . While not initially identified as a population at risk, pregnant woman may be more vulnerable to severe infection (Favre et al. 2020 ) and evidence from previous viral outbreaks suggests a higher risk of unfavourable maternal and neonatal outcomes in this population (Alfaraj et al. 2019) .Moreover, the associated policies developed as a result of the pandemic relating to social distancing and prevention of cross infection have led to important considerations specific to the field of maternal and neonatal health, and a necessity to consider unintended consequences for both the mother and baby (Buekens et al. 2020) .Countries are faced with a rapidly deve</code></p>
<hr>
<hr>
<p><code>#2</code>
<code>Answer:  While not initially identified as a population at risk, pregnant woman may be more vulnerable to severe infection (Favre et al., 2020) and evidence from previous viral outbreaks suggests a higher risk of unfavourable maternal and neonatal outcomes in this population</code></p>
<p><code>Research Paper:  COVID 19 in babies: Knowledge for neonatal care</code></p>
<p><code>Context: tified in Wuhan, Hubei, China. The disease manifests with a spectrum of symptoms ranging from mild upper respiratory tract infection to severe pneumonitis, acute respiratory distress syndrome (ARDS) and death. Relatively few cases have occurred in children and neonates who seem to have a more favourable clinical course than other age groups (De Rose et al., 2020). While not initially identified as a population at risk, pregnant woman may be more vulnerable to severe infection (Favre et al., 2020) and evidence from previous viral outbreaks suggests a higher risk of unfavourable maternal and neonatal outcomes in this population (Alfaraj et al., 2019). Moreover, the associated policies developed as a result of the pandemic relating to social distancing and prevention of cross infection have led to important considerations specific to the field of maternal and neonatal health, and a necessity to consider unintended consequences for both the mother and baby (Buekens et al., 2020).Countries</code></p>
<hr>
<p><strong>Example 3: Which organ does coronavirus impact?</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;Which organ does coronavirus impact?&#34;</span>
<span class="n">number_of_answers_to_fetch</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">get_answers</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span> <span class="n">top_k_retriever</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">top_k_reader</span><span class="o">=</span><span class="n">number_of_answers_to_fetch</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Question: {prediction[&#39;question&#39;]}&#34;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_answers_to_fetch</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;#{i+1}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Answer: {prediction[&#39;answers&#39;][i][&#39;answer&#39;]}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Research Paper: {prediction[&#39;answers&#39;][i][&#39;meta&#39;][&#39;name&#39;]}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;Context: {prediction[&#39;answers&#39;][i][&#39;context&#39;]}&#34;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.17 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.83 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.71 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.75 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.78 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.83 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:01&lt;00:00,  1.08s/ Batches]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:01&lt;00:00,  1.09s/ Batches]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.83 Batches/s]</code>
<code>Inferencing Samples: 100%|██████████| 1/1 [00:00&lt;00:00,  1.57 Batches/s]</code></p>
<hr>
<p><code>Question: which organ does coronavirus impact?</code></p>
<p><code>#1</code></p>
<p><code>Answer: central nervous system</code></p>
<p><code>Research Paper: Special considerations in the assessment of catastrophic brain injury and determination of brain death in patients with SARS-CoV-2</code></p>
<p><code>Context: ix patients with Covid-19 who developed catastrophic brain injuries. While only 3 of these patients were ultimately declared dead based on neurologic criteria, the other 3 had catastrophic irreversible brain damage prompting us to carefully consider whether they could be declared dead using neurologic criteria.A prerequisite to the determination of brain death is the identification of the proximate cause and irreversibility of injury. The exact mechanism by which Covid-19 affects the central nervous system remains largely unknown, but direct and indirect pathways of injury have been proposed. SARS-CoV-2 enters cells using ACE2 receptors, which are expressed in the brain and may facilitate direct damage to the cardiorespiratory center in the brainstem through trans-synaptic migration of the virus from the respiratory system [6,7]. Indirect damage to the central nervous system may occur from induction of pro-inflammatory cytokines in the glial cells of the brain and spinal cord, disrupti</code></p>
<hr>
<hr>
<p><code>#2</code>
<code>Answer: central nervous system</code></p>
<p><code>Research Paper: Journal Pre-proof Special considerations in the assessment of catastrophic brain injury and determination of brain death in patients with SARS- CoV-2 Special Considerations in the Assessment of Catastrophic Brain Injury and Determination of Brain Death in Patients with SARS- CoV-2</code></p>
<p><code>Context: ix patients with Covid-19 who developed catastrophic brain injuries. While only 3 of these patients were ultimately declared dead based on neurologic criteria, the other 3 had catastrophic irreversible brain damage prompting us to carefully consider whether they could be declared dead using neurologic criteria.A prerequisite to the determination of brain death is the identification of the proximate cause and irreversibility of injury. The exact mechanism by which Covid-19 affects the central nervous system remains largely unknown, but direct and indirect pathways of injury have been proposed. SARS-CoV-2 enters cells using ACE2 receptors, which are expressed in the brain and may facilitate direct damage to the cardiorespiratory center in the brainstem through trans-synaptic migration of the virus from the respiratory system [6, 7] . Indirect damage to the central nervous system may occur from induction of proinflammatory cytokines in the glial cells of the brain and spinal cord, disrupt</code></p>
<hr>
<p>The results are meaningful😄. Please note that we have used a pretrained model <code>deepset/roberta-base-squad2</code> for this tutorial. We might expect a significant improvement if we use a QA model trained specific to this dataset.</p>
<div class="details admonition success open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-check-circle fa-fw"></i>Attachments<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><a href="https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge" target="_blank" rel="noopener noreffer">Go to Dataset</a></li>
<li><a href="https://www.kaggle.com/officialshivanandroy/building-faster-accurate-cord-search-engine" target="_blank" rel="noopener noreffer">Go to Published Kaggle Kernel</a></li>
</ul>
</div>
        </div>
    </div>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 06/09/2020</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" data-title="Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗" data-via="snrspeaks" data-hashtags="Deep Learning,Transformers,Search Engine"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" data-hashtag="Deep Learning"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" data-title="Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" data-title="Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" data-title="Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="Share on Myspace" data-sharer="myspace" data-url="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" data-title="Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" data-title="Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="Share on Evernote" data-sharer="evernote" data-url="http://shivanandroy.com/building-a-faster-accurate-covid-search-engine-with-transformers/" data-title="Building A Faster &amp; Accurate COVID Search Engine with Transformers🤗"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/deep-learning/">Deep Learning</a>,&nbsp;<a href="/tags/transformers/">Transformers</a>,&nbsp;<a href="/tags/search-engine/">Search Engine</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/transformers-generating-arxiv-papers-title-from-abstracts/" class="prev" rel="prev" title="Training a T5 Transformer Model - Generating Titles from ArXiv Paper&#39;s Abstracts using 🤗Transformers"><i class="fas fa-angle-left fa-fw"></i>Training a T5 Transformer Model - Generating Titles from ArXiv Paper&#39;s Abstracts using 🤗Transformers</a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Shivanand Roy</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":100},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"title","label":"","lightTheme":"github-light","repo":"Shivanandroy/Blog"}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'UA-177212842-1', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-177212842-1" async></script></body>
</html>
